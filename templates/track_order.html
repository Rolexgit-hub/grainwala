{% extends "base.html" %}
{% block title %}Track Order - GrainWala{% endblock %}
{% set hide_footer = True %}
{% block content %}

<style>
.track-card{
  background:#fff;
  border-radius:14px;
  box-shadow:0 4px 24px rgba(27,45,27,0.12);
  padding:38px 32px;
  max-width:420px;
  margin:80px auto;
  text-align:center;
}
.track-card h2{
  color:#229742;
  font-size:2rem;
  margin-bottom:10px;
  font-weight:700;
}
.track-input{
  width:100%;
  padding:12px 18px;
  border-radius:8px;
  border:1px solid #b2ddc1;
  font-size:1rem;
  margin:16px 0 22px;
}
.track-btn{
  background:#ff5722;
  color:#fff;
  font-weight:600;
  padding:12px 36px;
  border-radius:8px;
  border:none;
  cursor:pointer;
}
.track-btn:hover{background:#e64a19}

.timeline{
  margin-top:30px;
  text-align:left;
}
.timeline-item{
  display:flex;
  gap:14px;
  padding:12px 0;
}
.icon{
  width:36px;
  height:36px;
  border-radius:50%;
  background:#229742;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
}
.details b{display:block}

.status-tracker{
  display:flex;
  align-items:center;
  justify-content:center;
  margin:30px 0 20px;
  flex-wrap:wrap;
}

.status-step{
  text-align:center;
  color:#9ca3af;
  font-size:13px;
  width:80px;
}

.status-step span{
  width:38px;
  height:38px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  background:#e5e7eb;
  margin:0 auto 6px;
  font-size:18px;
}

.status-step.active{
  color:#1b7f3a;
  font-weight:600;
}

.status-step.active span{
  background:#1b7f3a;
  color:#fff;
}

.status-line{
  width:40px;
  height:4px;
  background:#e5e7eb;
  border-radius:5px;
  margin:0 4px;
}

.status-line.active{
  background:#1b7f3a;
}
</style>

<div class="track-card">
  <h2>Track Your Order</h2>

  <form method="POST">
    <input type="text" name="order_id" class="track-input"
           placeholder="Enter Order ID (eg: OD12345678)" required>
    <button class="track-btn">Track Order</button>
  </form>

{% if order_info %}
  <div class="timeline">

    <div class="timeline-item">
      <div class="icon">ğŸ“¦</div>
      <div class="details">
        <b>Order ID</b>
        {{ order_info.order_id }}
      </div>
    </div>

    <div class="timeline-item">
      <div class="icon">ğŸ•’</div>
      <div class="details">
        <b>Order Date</b>
        {{ order_info.placed_at }}
      </div>
    </div>

    {# ğŸ”´ CANCELLED ORDER MESSAGE #}
    {% if order_info.status == 'Cancelled' %}
      <div style="
        background:#fee2e2;
        color:#b91c1c;
        padding:14px;
        border-radius:10px;
        text-align:center;
        font-weight:700;
        margin:20px 0;
      ">
        âŒ This order has been cancelled
      </div>
    {% endif %}

    {# ğŸŸ¢ STATUS TRACKER (ONLY IF NOT CANCELLED) #}
    {% if order_info.status != 'Cancelled' %}
    <div class="status-tracker">

      <div class="status-step {% if order_info.status in ['Placed','Packed','Shipped','Out for Delivery','Delivered'] %}active{% endif %}">
        <span>ğŸ“¦</span>
        <p>Placed</p>
      </div>

      <div class="status-line {% if order_info.status in ['Packed','Shipped','Out for Delivery','Delivered'] %}active{% endif %}"></div>

      <div class="status-step {% if order_info.status in ['Packed','Shipped','Out for Delivery','Delivered'] %}active{% endif %}">
        <span>ğŸ§º</span>
        <p>Packed</p>
      </div>

      <div class="status-line {% if order_info.status in ['Shipped','Out for Delivery','Delivered'] %}active{% endif %}"></div>

      <div class="status-step {% if order_info.status in ['Shipped','Out for Delivery','Delivered'] %}active{% endif %}">
        <span>ğŸšš</span>
        <p>Shipped</p>
      </div>

      <div class="status-line {% if order_info.status in ['Out for Delivery','Delivered'] %}active{% endif %}"></div>

      <div class="status-step {% if order_info.status in ['Out for Delivery','Delivered'] %}active{% endif %}">
        <span>ğŸ›µ</span>
        <p>Out for Delivery</p>
      </div>

      <div class="status-line {% if order_info.status == 'Delivered' %}active{% endif %}"></div>

      <div class="status-step {% if order_info.status == 'Delivered' %}active{% endif %}">
        <span>âœ…</span>
        <p>Delivered</p>
      </div>

    </div>
    {% endif %}

    <hr>

    {% for item in order_info["items"] %}
    <div class="timeline-item">
      <div class="icon">ğŸŒ¾</div>
      <div class="details">
        <b>{{ item.product_name }}</b>
        Qty: {{ item.quantity }} |
        â‚¹{{ item.price }}
      </div>
    </div>
    {% endfor %}

  </div>
{% endif %}

{% if error_message %}
  <p style="color:red;margin-top:20px">{{ error_message }}</p>
{% endif %}
</div>

{% endblock %}
