{% extends "base.html" %}
{% block title %}Order Details - Farmer Panel{% endblock %}
{% set hide_footer = True %}

{% block content %}
<div class="container my-5">

  <!-- Back Button -->
  <a href="{{ url_for('farmer_orders') }}" class="btn btn-outline-success mb-4 fw-bold rounded-3 shadow-sm px-4 py-2">
    <i class="bi bi-arrow-left"></i> Back to Orders
  </a>

  <!-- Order Info -->
  <div class="card shadow-lg rounded-4 border-0 mb-4 px-4 py-4 bg-white">
    <div class="card-header bg-gradient bg-success text-white fw-bold fs-4 rounded-top-4 border-0">
      <i class="bi bi-receipt-cutoff me-2"></i> Order Summary
    </div>
    <div class="card-body">
      <div class="row gy-3">
        <div class="col-md-6">
          <h6 class="text-muted mb-2 fw-bold">Buyer Information</h6>
          <p class="mb-1"><strong>Name:</strong> {{ order.full_name }}</p>
          <p class="mb-1"><strong>Phone:</strong> {{ order.phone }}</p>
          <p class="mb-1"><strong>Address:</strong> {{ order.address }}, {{ order.city }}, {{ order.state }} - {{ order.pincode }}</p>
        </div>
        <div class="col-md-6">
          <h6 class="text-muted mb-2 fw-bold">Order Details</h6>
          <p class="mb-1"><strong>Order ID:</strong> {{ order.order_id }}</p>
          <p class="mb-1"><strong>Total Amount:</strong> ₹{{ order.total_amount }}</p>
          <p class="mb-1"><strong>Payment Method:</strong> {{ order.payment_method }}</p>
          <p class="mb-1"><strong>Date:</strong>
            {% if order.created_at %}
              {{ order.created_at.strftime('%d %b %Y %H:%M') }}
            {% else %}
              -
            {% endif %}
          </p>
        </div>
      </div>
      <hr class="my-4">

      <!-- Order Status -->
      <div class="d-flex flex-wrap align-items-center gap-3">
        <h6 class="mb-0 fw-bold text-muted">Order Status:</h6>
        <form method="POST" action="{{ url_for('farmer_update_order_status', order_id=order.order_id) }}" class="d-flex align-items-center gap-2">
       <select name="status" class="form-select form-select-sm w-auto shadow-sm fw-bold rounded-2">
  <option value="Placed" {% if order.status == 'Placed' %}selected{% endif %}>Placed</option>
  <option value="Packed" {% if order.status == 'Packed' %}selected{% endif %}>Packed</option>
  <option value="Shipped" {% if order.status == 'Shipped' %}selected{% endif %}>Shipped</option>
  <option value="Out for Delivery" {% if order.status == 'Out for Delivery' %}selected{% endif %}>Out for Delivery</option>
  <option value="Delivered" {% if order.status == 'Delivered' %}selected{% endif %}>Delivered</option>

  {% if order.status in ['Placed','Packed'] %}
    <option value="Cancelled">Cancelled</option>
  {% endif %}
</select>

          <button type="submit" class="btn btn-success btn-sm rounded-2 fw-bold px-3 shadow-sm">
            <i class="bi bi-check2-circle"></i> Update
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Product Table -->
  <div class="card shadow-lg rounded-4 border-0">
    <div class="card-header bg-light fw-bold fs-5 rounded-top-4 border-0">
      <i class="bi bi-box2-heart text-success me-2"></i> Products in this Order
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-bordered align-middle text-center mb-0 table-hover shadow-sm">
          <thead class="table-success">
            <tr>
              <th>Product</th>
              <th>Image</th>
              <th>Quantity</th>
              <th>Price</th>
              <th>Subtotal</th>
            </tr>
          </thead>
          <tbody>
            {% for it in items %}
            <tr>
              <td class="fw-semibold">{{ it.product_name }}</td>
              <td>
                {% if it.product_images %}
                  {% set imgs = it.product_images %}
                  {% if imgs is string and imgs.startswith('[') %}
                    {% set arr = imgs | from_json %}
                    {% if arr %}
                      <img src="{{ url_for('static', filename='images/' + arr[0]) }}" width="70" height="70" class="rounded-3 border shadow-sm" style="object-fit:cover;">
                    {% endif %}
                  {% elif imgs %}
                    <img src="{{ url_for('static', filename='images/' + imgs) }}" width="70" height="70" class="rounded-3 border shadow-sm" style="object-fit:cover;">
                  {% else %}
                    <img src="{{ url_for('static', filename='no-image.png') }}" width="70" height="70" class="rounded-3 border shadow-sm" style="object-fit:cover;">
                  {% endif %}
                {% else %}
                  <img src="{{ url_for('static', filename='no-image.png') }}" width="70" height="70" class="rounded-3 border shadow-sm" style="object-fit:cover;">
                {% endif %}
              </td>
              <td class="fw-bold">{{ it.quantity }}</td>
              <td>₹{{ it.price }}</td>
              <td class="fw-bold text-success">₹{{ (it.price | float) * (it.quantity | int) }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<style>
body {
  background: linear-gradient(135deg, #e6f9e6 0%, #f8fff8 100%);
}
.card {
  border-radius: 20px !important;
  box-shadow: 0 4px 24px rgba(14, 62, 23, 0.12) !important;
  padding: 2rem 1.5rem;
}
.card-header {
  font-size: 1.2rem;
  letter-spacing: 0.5px;
  background: linear-gradient(135deg, #39b96d 0%, #81e89a 100%) !important;
  color: #fff !important;
  font-weight: 700;
  border-radius: 20px 20px 0 0 !important;
  border: none !important;
}
.table th, .table td {
  vertical-align: middle !important;
  font-size: 1rem;
  padding: 12px 18px !important;
}
.table-hover tbody tr:hover {
  background-color: #f6fff8 !important;
}
.table img {
  border-radius: 12px !important;
  box-shadow: 0 2px 12px rgba(0,120,61,0.10);
  transition: transform 0.2s;
}
.table img:hover {
  transform: scale(1.11);
}
.form-select {
  border-radius: 8px !important;
  font-weight: 500;
  box-shadow: 0 2px 7px rgba(70,160,80,0.09);
}
.btn-success {
  border-radius: 8px !important;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 2px;
  transition: background 0.2s, box-shadow 0.2s;
  box-shadow: 0 2px 7px rgba(0,120,61,0.03);
}
.btn-success:hover {
  background: #219150 !important;
  box-shadow: 0 4px 16px rgba(0,120,61,0.14);
}
.btn-outline-success {
  border-radius: 8px !important;
  font-weight: 600;
  letter-spacing: 1px;
}
.bg-gradient {
  background-image: linear-gradient(135deg, #39b96d 0%, #81e89a 100%) !important;
}
</style>
{% endblock %}
